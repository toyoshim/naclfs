#!/bin/bash

function _wrap() {
  /bin/echo -n "-Xlinker --wrap -Xlinker $1 "
}

function cflags() {
  /bin/echo -n "-I$1/../src -Dmain=naclfs_main -Deaccess=access"
}

function crt() {
  if [ $2 = "pnacl" ]; then
    /bin/echo -n "$1/../obj/$2/newlib-$2/naclfs_crt.o"
  else
    /bin/echo -n "$1/../obj/$2-nacl/naclfs_crt.o"
  fi
}

function libs() {
  _wrap "access"
  _wrap "isatty"
  _wrap "fcntl"
  /bin/echo -n "-L$NACL_SDK_ROOT/lib/"
  /bin/echo -n "$2/Release " | sed -e 's/-/_/' | sed -e 's/i686/x86_32/'
  if [ $2 = "pnacl" ]; then
    /bin/echo -n "-L$1/../obj/$2/newlib-$2 -lnaclfs -lppapi_cpp -lstdc++"
  else
    /bin/echo -n "-L$1/../obj/$2-nacl -lnaclfs -lppapi_cpp -lstdc++"
  fi
}

function nmf() {
  /bin/echo -n "-L $1/../obj/glibc-i686-nacl -L $1/../obj/glibc-x86_64-nacl"
}

function help() {
  /bin/echo -n "Usage: naclfs-config [--cflags toolchain] [--libs toolchain] "
  echo "[--nmf] [--crt toolchain]"
  echo "  toolchain:"
  echo "    newlib-i686   ... 32-bit static library for newlib"
  echo "    newlib-x86_64 ... 64-bit static library for newlib"
  echo "    glibc-i686    ... 32-bit static library for glibc"
  echo "    glibc-x86_64  ... 64-bit static library for glibc"
  echo "    pnacl         ... static library for pnacl"
}

DIRNAME="`dirname $0`"
TOOLCHAIN=$2

case $1 in
  --cflags) cflags $DIRNAME $TOOLCHAIN;;
  --crt) crt $DIRNAME $TOOLCHAIN;;
  --libs) libs $DIRNAME $TOOLCHAIN;;
  --nmf) nmf $DIRNAME;;
  *) help;;
esac

