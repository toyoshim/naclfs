#!/bin/sh

function _wrap() {
  /bin/echo -n "-Xlinker --wrap -Xlinker $1 "
}

function cflags() {
  /bin/echo -n "-I$1/../src -Dmain=naclfs_main -Deaccess=access"
}

function crt() {
  /bin/echo -n "$1/../obj/$2/naclfs_crt.o"
}

function libs() {
  _wrap "access"
  _wrap "isatty"
  _wrap "fcntl"
  if [ $2 = "pnacl/newlib-pnacl" ]; then
    /bin/echo -n "-L $NACL_SDK_ROOT/lib/pnacl/Release "
  fi
  /bin/echo -n "-L$1/../obj/$2 -lnaclfs -lppapi_cpp -lstdc++"
}

function nmf() {
  /bin/echo -n "-L $1/../obj/glibc-i686 -L $1/../obj/glibc-x86_64"
}

function help() {
  /bin/echo -n "Usage: naclfs-config [--cflags toolchain] [--libs toolchain] "
  echo "[--nmf] [--crt toolchain]"
  echo "  toolchain:"
  echo "    newlib-i686   ... 32-bit static library for newlib"
  echo "    newlib-x86_64 ... 64-bit static library for newlib"
  echo "    glibc-i686    ... 32-bit static library for glibc"
  echo "    glibc-x86_64  ... 64-bit static library for glibc"
  echo "    pnacl         ... static library for pnacl"
}

DIRNAME="`dirname $0`"

TOOLCHAIN=$2
if [ $2 = "pnacl" ]; then
  TOOLCHAIN=pnacl/newlib-pnacl
fi

case $1 in
  --cflags) cflags $DIRNAME $TOOLCHAIN;;
  --crt) crt $DIRNAME $TOOLCHAIN;;
  --libs) libs $DIRNAME $TOOLCHAIN;;
  --nmf) nmf $DIRNAME;;
  *) help;;
esac

